# Neon DB 브랜치 활성화 가이드

## 문제 상황
현재 Neon DB의 브랜치가 **SUSPENDED** 상태로 확인됩니다. 이 상태에서는 데이터베이스 연결이 불가능하며, 다음과 같은 증상이 발생합니다:

- 데이터베이스 연결 시도 시 타임아웃 또는 연결 거부 오류
- API 요청이 실패하거나 데이터를 가져오지 못함
- "메인 사이트 패키지 가져오기" 기능이 동작하지 않음
- 관리자 페이지에서 패키지 목록이 표시되지 않음

## 해결 방법

### 1. Neon DB 브랜치 활성화하기
1. [Neon 콘솔](https://console.neon.tech)에 로그인
2. 해당 프로젝트 선택
3. "Branches" 탭으로 이동
4. SUSPENDED 상태의 브랜치 찾기
5. "Resume" 또는 "활성화" 버튼 클릭
6. 브랜치 상태가 "Active"로 변경될 때까지 대기 (보통 몇 초 소요)

### 2. 데이터베이스 연결 확인
브랜치가 활성화된 후 다음 명령어로 연결 상태를 확인:

```bash
node check-db.js
```

### 3. 앱 재시작 (필요시)
로컬 개발 서버를 다시 시작:

```bash
npm run dev
```

### 4. Netlify 재배포 (필요시)
Netlify에 변경 사항을 푸시하여 재배포:

```bash
git add .
git commit -m "Neon DB 브랜치 활성화 및 연결 확인"
git push
```

## 예방 조치

### 자동 활성화 방지
Neon DB는 일정 시간 사용하지 않으면 자동으로 브랜치를 일시 중지(SUSPEND)합니다. 이를 방지하기 위한 몇 가지 방법:

1. **정기적인 DB 접근**: 크론 작업을 설정하여 정기적으로 DB에 접근
2. **유료 플랜 고려**: 프로덕션 환경에서는 유료 플랜으로 업그레이드하여 자동 일시 중지 기능 비활성화
3. **Health Check API**: 정기적으로 호출되는 헬스 체크 API에 간단한 DB 쿼리 추가

### 연결 오류 처리
애플리케이션 코드에서 Neon DB 연결 오류를 적절히 처리:

1. **자동 재시도 로직**: 첫 번째 연결 시도가 실패하면 잠시 후 다시 시도
2. **오류 메시지 개선**: SUSPENDED 상태 감지 시 명확한 오류 메시지 표시
3. **폴백 메커니즘**: 중요 기능에 대한 대체 로직 구현 (예: 캐시된 데이터 사용)

## 참고 사항
- Neon DB 브랜치는 보통 약 5~7일 동안 활동이 없으면 자동으로 일시 중지됩니다.
- 브랜치가 일시 중지되면 모든 연결이 종료되고 새 연결을 받지 않습니다.
- 브랜치를 다시 활성화해도 데이터는 손실되지 않습니다.
